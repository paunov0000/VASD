@model ProductDetailsViewModel

@{
    ViewData["Title"] = "Details";
}



<div class="flex">
    <div>
        <img src="@Model.ProductImg" alt="Alternate Text" />
    </div>
    <div>
        <p>
            <a class="font-light underline" href="#">@Model.BrandName</a> <span class="font-bold">@Model.Name</span>
        </p>
        <p>@Model.CategoryName</p>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById("increment").onclick = () => {
            var text = document.getElementById("quantity");

            if (text.value === "") {
                return text.value = 1
            }

            var qty = parseInt(text.value);

            text.value = qty + 1;
        }
    </script>

    <script>
        document.getElementById("decrement").onclick = () => {
            var text = document.getElementById("quantity");

            if (text.value === "") {
                return text.value = 1
            }

            var qty = parseInt(text.value);

            if (qty - 1 < 1) {
                return text.value = 1
            }

            text.value = qty - 1;
        }
    </script>

    <script>
        document.getElementById("add-to-cart").onclick = () => {
            let productId = document.getElementById("product-id");
            let pname = document.getElementById("name");
            let price = document.getElementById("price");
            let quantity = document.getElementById("quantity");

            let product = {
                id: productId.value,
                name: pname.value,
                price: parseFloat(price.value),
                quantity: parseInt(quantity.value),
                totalPrice: roundToTwo(price.value * quantity.value)
            }

            if (!localStorage.getItem("cart")) {
                localStorage.setItem("cart", "[]");
            }


            function addItemToCart(product) {
                let cart = JSON.parse(localStorage.getItem("cart"));
                if (cart.length === 0) {
                    cart.push(product);
                }
                else {
                    let isPresent = cart.find(x => x.id === product.id);

                    if (isPresent === undefined) {
                        cart.push(product)
                    }
                    else {
                        isPresent.quantity += product.quantity;
                        isPresent.totalPrice = roundToTwo(isPresent.price * isPresent.quantity);
                    }
                }

                localStorage.setItem("cart", JSON.stringify(cart));
            }

            function roundToTwo(num) {
                return +(Math.round(num + "e+2") + "e-2");
            }

            addItemToCart(product);
        }
    </script>
}